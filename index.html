<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMB | Pro Dashboard</title>

    <link rel="icon" type="image/png" href="https://i.postimg.cc/QNkbRTbS/1.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        :root {
            --primary: #0f172a;
            --accent: #ef4444;
            --accent-hover: #dc2626;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --radius-lg: 16px;
            --radius-md: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background-color: var(--bg);
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            color: var(--text-main);
            display: flex;
            min-height: 100vh;
        }

        /* ===== LAYOUT ===== */
        .app-container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 280px;
            background: var(--primary);
            color: white;
            display: flex;
            flex-direction: column;
            padding: 24px;
            position: sticky;
            top: 0;
            height: 100vh;
            transition: 0.3s;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .logo-area img { width: 35px; height: 35px; }
        .logo-area span { font-weight: 800; font-size: 20px; letter-spacing: 1px; }

        /* ===== MAIN CONTENT ===== */
        .main-stage {
            flex-grow: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        /* ===== USER PROFILE BLOCK ===== */
        .profile-card {
            background: var(--card-bg);
            padding: 8px 16px;
            border-radius: 100px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .profile-card img { width: 32px; height: 32px; border-radius: 50%; }
        .profile-card .info { line-height: 1.2; }
        .profile-card .name { font-size: 14px; font-weight: 600; }
        .logout-mini { 
            background: none; border: none; color: var(--text-muted); 
            cursor: pointer; padding: 5px; transition: 0.2s;
        }
        .logout-mini:hover { color: var(--accent); }

        /* ===== GRID SYSTEM ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 24px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .card:hover:not(.disabled) {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05);
            border-color: var(--accent);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: #f1f5f9;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--primary);
            transition: 0.3s;
        }

        .card:hover .card-icon {
            background: var(--accent);
            color: white;
        }

        .card-title { font-weight: 700; font-size: 18px; margin: 0; }
        .card-desc { color: var(--text-muted); font-size: 13px; margin: 0; }

        /* ===== DROP LINKS ===== */
        .drop-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }

        .drop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: #f8fafc;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-main);
            font-size: 13px;
            font-weight: 600;
            transition: 0.2s;
        }

        .drop-item:hover { background: var(--primary); color: white; }

        /* ===== AUTH PAGE ===== */
        .auth-screen {
            position: fixed;
            inset: 0;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .auth-box {
            background: white;
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        /* ===== UTILS ===== */
        .disabled { opacity: 0.5; filter: grayscale(1); pointer-events: none; }
        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-stage { padding: 20px; }
            .header-bar { flex-direction: column; gap: 20px; align-items: flex-start; }
        }
    </style>
</head>
<body>

<div id="login-screen" class="auth-screen">
    <div class="auth-box">
        <img src="https://i.postimg.cc/QNkbRTbS/1.png" alt="Logo" style="width: 60px; margin-bottom: 20px;">
        <h2 style="margin-bottom: 10px;">Welcome Back</h2>
        <p style="color: var(--text-muted); margin-bottom: 30px;">Please sign in to access SMB Dashboard</p>
        <div id="g_id_onload"
             data-client_id="328749588235-bgfeukqogpoq2ha65j7j0vk840hctiaq.apps.googleusercontent.com"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin" data-type="standard" data-shape="pill" data-theme="filled_black"></div>
    </div>
</div>

<div id="app" class="app-container hidden">
    <aside class="sidebar">
        <div class="logo-area">
            <img src="https://i.postimg.cc/QNkbRTbS/1.png" alt="SMB">
            <span>SMB PRO</span>
        </div>
        <nav style="flex-grow: 1;">
            <p style="font-size: 11px; text-transform: uppercase; opacity: 0.5; letter-spacing: 1px; margin-bottom: 20px;">Main Menu</p>
            <div style="color: #94a3b8; font-size: 14px; display: flex; flex-direction: column; gap: 15px;">
                <div style="display: flex; align-items: center; gap: 10px; color: white;"><i class="fas fa-th-large"></i> Dashboard</div>
                <div style="display: flex; align-items: center; gap: 10px;"><i class="fas fa-file-alt"></i> Reports</div>
                <div style="display: flex; align-items: center; gap: 10px;"><i class="fas fa-user-shield"></i> Admin</div>
            </div>
        </nav>
        <div style="font-size: 12px; opacity: 0.3;">v2.1.0 Build 2024</div>
    </aside>

    <main class="main-stage">
        <header class="header-bar">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Systems Overview</h1>
                <p style="margin: 5px 0 0; color: var(--text-muted);">Manage your bowling centers and resources</p>
            </div>
            
            <div class="profile-card">
                <img id="user-pic" src="" alt="">
                <div class="info">
                    <div class="name" id="user-name">Username</div>
                </div>
                <button class="logout-mini" onclick="signOut()"><i class="fas fa-power-off"></i></button>
            </div>
        </header>

        <div class="dashboard-grid">
            <a href="https://smart-bowling.github.io/MANUALS-SMART/" target="_blank" style="text-decoration: none; color: inherit;">
                <div class="card" id="manuals-btn">
                    <div class="card-icon"><i class="fas fa-book-open"></i></div>
                    <div>
                        <h3 class="card-title">Manuals</h3>
                        <p class="card-desc">Documentation and guides for all systems</p>
                    </div>
                </div>
            </a>

            <a href="https://smart-bowling.github.io/PARTS-STORE/" target="_blank" style="text-decoration: none; color: inherit;">
                <div class="card" id="store-btn">
                    <div class="card-icon"><i class="fas fa-shopping-cart"></i></div>
                    <div>
                        <h3 class="card-title">Parts Store</h3>
                        <p class="card-desc">Order replacement parts and hardware</p>
                    </div>
                </div>
            </a>

            <div class="card" id="card-parts">
                <div class="card-icon"><i class="fas fa-gears"></i></div>
                <div>
                    <h3 class="card-title">Parts Catalog</h3>
                    <p class="card-desc">Select center for inventory</p>
                </div>
                <div class="drop-menu" id="drop-parts"></div>
            </div>

            <div class="card" id="card-maintenance">
                <div class="card-icon"><i class="fas fa-screwdriver-wrench"></i></div>
                <div>
                    <h3 class="card-title">Maintenance</h3>
                    <p class="card-desc">Service logs and scheduling</p>
                </div>
                <div class="drop-menu" id="drop-maintenance"></div>
            </div>

            <div class="card" id="card-fps">
                <div class="card-icon"><i class="fas fa-gauge-high"></i></div>
                <div>
                    <h3 class="card-title">FPS Monitor</h3>
                    <p class="card-desc">Real-time performance metrics</p>
                </div>
                <div class="drop-menu" id="drop-fps"></div>
            </div>

            <div class="card" id="card-analysis">
                <div class="card-icon"><i class="fas fa-chart-pie"></i></div>
                <div>
                    <h3 class="card-title">Analytics</h3>
                    <p class="card-desc">Deep data and bowling stats</p>
                </div>
                <div class="drop-menu" id="drop-analysis"></div>
            </div>
        </div>
    </main>
</div>

<script>
// (Логика скрипта остается прежней, добавляем только отображение списков сразу)
const userPermissions = {
    'vadiksss900@gmail.com': {
        manuals: true, store: true,
        luckyStrike: { parts: true, maintenance: true, fps: true },
        blockbuster: { parts: true, maintenance: true, analysis: true, fps: true },
        skymall: { parts: true, maintenance: true, analysis: true, fps: true }
    },
    'csportsua@gmail.com': {
        manuals: true, store: false,
        luckyStrike: { parts: false, maintenance: false, fps: false },
        blockbuster: { parts: false, maintenance: false, analysis: false, fps: false },
        skymall: { parts: true, maintenance: false, analysis: false, fps: false }
    }
};

const linksMap = {
    parts: [
        { name: 'Lucky Strike KH', url: 'https://smart-bowling.github.io/PARTS-KH/', key: 'luckyStrike' },
        { name: 'Blockbuster', url: 'https://smart-bowling.github.io/PARTS-BB/', key: 'blockbuster' },
        { name: 'Skymall', url: 'https://smart-bowling.github.io/PARTS-SKYMALL/', key: 'skymall' }
    ],
    maintenance: [
        { name: 'Lucky Strike KH', url: 'https://smart-bowling.github.io/SMB-LS-KH/', key: 'luckyStrike' },
        { name: 'Blockbuster', url: 'https://smart-bowling.github.io/SMB-BB/', key: 'blockbuster' },
        { name: 'Skymall', url: 'https://smart-bowling.github.io/SMB-SKYMALL/', key: 'skymall' }
    ],
    fps: [
        { name: 'Lucky Strike KH', url: 'https://smart-bowling.github.io/PS-STOP-KH/', key: 'luckyStrike' },
        { name: 'Blockbuster', url: 'https://smart-bowling.github.io/PS-STOP-BB/', key: 'blockbuster' },
        { name: 'Skymall', url: 'https://smart-bowling.github.io/PS-STOP-SKYMALL/', key: 'skymall' }
    ],
    analysis: [
        { name: 'Blockbuster', url: 'https://smart-bowling.github.io/ANALYSIS-BB/', key: 'blockbuster' },
        { name: 'Skymall', url: 'https://smart-bowling.github.io/ANALYSIS-SM/', key: 'skymall' }
    ]
};

function handleCredentialResponse(response) {
    const payload = parseJwt(response.credential);
    const email = payload.email.toLowerCase();
    if (userPermissions[email]) loginUser(payload); else alert("Access Denied: " + email);
}

function loginUser(payload) {
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    document.getElementById('user-pic').src = payload.picture;
    document.getElementById('user-name').textContent = payload.name;
    
    localStorage.setItem('userLoggedIn', 'true');
    localStorage.setItem('userEmail', payload.email.toLowerCase());
    localStorage.setItem('userName', payload.name);
    localStorage.setItem('userPic', payload.picture);
    
    renderMenus(payload.email.toLowerCase());
}

function renderMenus(email) {
    const p = userPermissions[email];
    
    // Manuals/Store simple toggle
    document.getElementById('manuals-btn').parentElement.classList.toggle('disabled', !p.manuals);
    document.getElementById('store-btn').parentElement.classList.toggle('disabled', !p.store);

    // Dynamic Lists
    Object.keys(linksMap).forEach(type => {
        const available = linksMap[type].filter(item => p[item.key] && p[item.key][type]);
        const container = document.getElementById(`drop-${type}`);
        const card = document.getElementById(`card-${type}`);

        if (available.length === 0) {
            card.classList.add('disabled');
        } else {
            container.innerHTML = available.map(link => 
                `<a href="${link.url}" target="_blank" class="drop-item">
                    ${link.name} <i class="fas fa-chevron-right" style="font-size:10px; opacity:0.5"></i>
                </a>`
            ).join('');
        }
    });
}

function parseJwt(token) {
    return JSON.parse(atob(token.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')));
}

function signOut() { localStorage.clear(); location.reload(); }

window.onload = () => {
    if (localStorage.getItem('userLoggedIn') === 'true') {
        const email = localStorage.getItem('userEmail');
        if (userPermissions[email]) {
            loginUser({
                email: email,
                name: localStorage.getItem('userName'),
                picture: localStorage.getItem('userPic')
            });
        }
    }
}
</script>
</body>
</html>
